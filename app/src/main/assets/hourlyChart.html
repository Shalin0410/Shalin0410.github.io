<!DOCTYPE html>
<html>
    <body>
        <div id="chartContainer" style="height: 100%; width: 100%;"></div> 
        <script src="https://code.highcharts.com/stock/highstock.js"></script>
        <script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
        <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/stock/indicators/indicators.js"></script>
        <script src="https://code.highcharts.com/stock/indicators/volume-by-price.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>
        <script>
            let symbol = Android.getSymbol();
            let currentDate = new Date();
            let offset = -7.0; // PST is UTC-8
            let pstDate = new Date(currentDate.getTime() + offset * 3600 * 1000);
            console.log('PST Date: ', pstDate);

            let hours = pstDate.getHours();
            let minutes = pstDate.getMinutes();
            let dayOfWeek = pstDate.getDay();
            console.log('Day of Week: ', dayOfWeek);
            console.log('Hours: ', hours);
            console.log('Minutes: ', minutes);

            (async () => {
            const data = await fetch(
                'https://assign2shalin.wl.r.appspot.com/hourlycharts/'+symbol
            ).then(response => response.json());
            console.log(data.results);
            let marketOpen = (dayOfWeek >= 1 && dayOfWeek <= 5) && // Monday to Friday
                        (hours > 6 || (hours === 6 && minutes >= 30)) && // After 6:30 AM
                        hours < 13; // Before 1:00 PM

                // create the chart
                Highcharts.stockChart('chartContainer', {

                    chart: {
                        backgroundColor: 'white',
                    },
                    title: {
                        text: symbol + ' Hourly Price Variation',
                        style: {
                        color: 'grey',
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    xAxis: {
                        type: 'datetime',
                    },
                    yAxis: {
                        startOnTick: false,
                        endOnTick: false,
                        title: {
                        text: ''
                        },
                        opposite: true,
                    },
                    plotOptions: {
                        line: {
                            marker: {
                                enabled: false
                            },
                            zones: [{
                                color: marketOpen ? 'green' : 'red'
                            }]
                        }
                    },
                    series: [{
                        data: data.results.map((result) => [result.t, result.c]),
                        type: 'line'
                    }],
                });
            })();   
                            
        </script>
    </body>
</html>